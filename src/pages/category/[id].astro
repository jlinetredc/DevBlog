---
import { getCollection } from 'astro:content';
import Page from './[id]/[page].astro';
import { SITE_CONFIG } from '../../lib/constants';

export async function getStaticPaths() {
    const { CATEGORIES } = await import('../../lib/categories');
    return Object.values(CATEGORIES).map(cat => ({ params: { id: cat.id } }));
}

const { id } = Astro.params;
const allPosts = await getCollection('blog');
const filteredPosts = allPosts
    .filter(post => post.data.category === id)
    .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const pageSize = SITE_CONFIG.pageSize;
const page = {
    data: filteredPosts.slice(0, pageSize),
    currentPage: 1,
    lastPage: Math.ceil(filteredPosts.length / pageSize),
    url: { prev: undefined, next: filteredPosts.length > pageSize ? `/category/${id}/2` : undefined }
};
---

<Page page={page} />