---
import { getAssetPath } from '../lib/utils';
const navItems = [
    { name: 'Trang chủ', href: '/' },
    { name: 'Bài viết', href: '/blog' },
    { name: 'Giới thiệu', href: '/about' },
];
---

<header class="bg-white/80 backdrop-blur-md sticky top-0 z-50 border-b border-slate-100">
    <div class="max-w-5xl mx-auto px-6 h-20 flex items-center justify-between">
        <a href={getAssetPath('/')} class="flex items-center gap-2 group">
            <div class="w-10 h-10 bg-orange-600 rounded-lg flex items-center justify-center group-hover:rotate-6 transition-transform">
                <span class="text-white font-bold text-xl">D</span>
            </div>
            <span class="text-xl font-black tracking-tight text-slate-800">
                DEV<span class="text-orange-600">BLOG</span>
            </span>
        </a>

        <div class="relative flex-grow max-w-md mx-4">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <svg class="h-5 w-5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
            </div>
            <input 
                type="text" 
                id="search-input"
                placeholder="Tìm kiếm bài viết..." 
                class="block w-full pl-10 pr-3 py-2 border border-slate-200 rounded-xl bg-slate-50 text-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-orange-500/20 focus:border-orange-500 transition-all"
            />
            <div id="search-results" class="absolute mt-2 w-full bg-white border border-slate-100 rounded-xl shadow-2xl hidden max-h-96 overflow-y-auto z-50">
                </div>
        </div>
    </div>
</header>

<script>
    let searchData = [];
    const searchInput = document.getElementById('search-input');
    const searchResults = document.getElementById('search-results');

    // 1. Tải dữ liệu tìm kiếm ngay khi người dùng nhấn vào ô input (để tiết kiệm tài nguyên)
    searchInput?.addEventListener('focus', async () => {
        if (searchData.length === 0) {
            const response = await fetch('/search.json');
            searchData = await response.json();
        }
    }, { once: true });

    // 2. Xử lý tìm kiếm khi gõ
    searchInput?.addEventListener('input', (e) => {
        const query = e.target.value.toLowerCase().trim();

        if (query.length < 2) {
            searchResults.classList.add('hidden');
            return;
        }

        const filtered = searchData.filter(post =>
            post.title.toLowerCase().includes(query) ||
            post.description.toLowerCase().includes(query)
        ).slice(0, 5); // Chỉ lấy 5 kết quả đầu tiên cho gọn

        renderResults(filtered);
    });

    function renderResults(results) {
        if (results.length === 0) {
            searchResults.innerHTML = `<div class="p-4 text-sm text-slate-500">Không tìm thấy bài viết nào.</div>`;
        } else {
            searchResults.innerHTML = results.map(post => `
                <a href="${post.slug}" class="block p-4 hover:bg-orange-50 transition-colors border-b border-slate-50 last:border-0">
                    <div class="text-[10px] font-bold text-orange-600 uppercase mb-1">${post.category}</div>
                    <div class="text-sm font-bold text-slate-900">${post.title}</div>
                    <div class="text-xs text-slate-500 line-clamp-1">${post.description}</div>
                </a>
            `).join('');
        }
        searchResults.classList.remove('hidden');
    }

    // Đóng khi nhấn ra ngoài
    document.addEventListener('click', (e) => {
        if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
            searchResults.classList.add('hidden');
        }
    });
</script>